# Silero VAD è¯­éŸ³æ´»åŠ¨æ£€æµ‹æœåŠ¡

è¿™æ˜¯ä¸€ä¸ªåŸºäº Silero VAD çš„è¯­éŸ³æ´»åŠ¨æ£€æµ‹æœåŠ¡ï¼Œä½¿ç”¨ FastAPI æä¾› HTTP æ¥å£ã€‚è¯¥æœåŠ¡å¯ä»¥æ£€æµ‹éŸ³é¢‘æ–‡ä»¶ä¸­çš„è¯­éŸ³ç‰‡æ®µï¼Œå¹¶è¿”å›è¯¦ç»†çš„æ—¶é—´æˆ³å’Œç»Ÿè®¡ä¿¡æ¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **é«˜ç²¾åº¦è¯­éŸ³æ£€æµ‹**ï¼šåŸºäº Silero VAD æ·±åº¦å­¦ä¹ æ¨¡å‹
- ğŸ”§ **å¯è°ƒèŠ‚å‚æ•°**ï¼šæ”¯æŒè‡ªå®šä¹‰æ£€æµ‹é˜ˆå€¼å’Œæ—¶é•¿å‚æ•°
- ğŸ“Š **è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯**ï¼šæä¾›è¯­éŸ³å æ¯”ã€ç‰‡æ®µæ•°é‡ç­‰ç»Ÿè®¡æ•°æ®
- ğŸµ **å¤šæ ¼å¼æ”¯æŒ**ï¼šæ”¯æŒ WAVã€MP3ã€FLAC æ ¼å¼
- ğŸš€ **é«˜æ€§èƒ½**ï¼šå»¶è¿ŸåŠ è½½æ¨¡å‹ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨
- ğŸ“‹ **å®Œæ•´APIæ–‡æ¡£**ï¼šè‡ªåŠ¨ç”Ÿæˆçš„ OpenAPI æ–‡æ¡£

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PyTorch 2.0+
- å…¶ä»–ä¾èµ–è§ `requirements.txt`

## å¿«é€Ÿå¼€å§‹

### 1. è‡ªåŠ¨å®‰è£…ä¸å¯åŠ¨

```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./start_vad.sh
```

### 2. æ‰‹åŠ¨å®‰è£…

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
.\venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡
python vad_server.py
```

æœåŠ¡å°†åœ¨ http://127.0.0.1:8000 å¯åŠ¨ã€‚

## API æ¥å£

### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
GET /
```

è¿”å›æœåŠ¡çŠ¶æ€å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚

### 2. å¥åº·æ£€æŸ¥

```bash
GET /health
```

æ£€æŸ¥æœåŠ¡å’Œæ¨¡å‹åŠ è½½çŠ¶æ€ã€‚

### 3. æ¨¡å‹ä¿¡æ¯

```bash
GET /info
```

è·å–æ¨¡å‹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ”¯æŒçš„æ ¼å¼å’Œå‚æ•°ã€‚

### 4. è¯­éŸ³æ´»åŠ¨æ£€æµ‹

```bash
POST /detect
```

**è¯·æ±‚å‚æ•°**ï¼š
- `audio_file`ï¼šéŸ³é¢‘æ–‡ä»¶ï¼ˆWAV/MP3/FLAC æ ¼å¼ï¼‰
- `threshold`ï¼šæ£€æµ‹é˜ˆå€¼ (0.0-1.0)ï¼Œé»˜è®¤ 0.5
- `min_speech_duration_ms`ï¼šæœ€å°è¯­éŸ³æŒç»­æ—¶é—´(æ¯«ç§’)ï¼Œé»˜è®¤ 250
- `min_silence_duration_ms`ï¼šæœ€å°é™éŸ³æŒç»­æ—¶é—´(æ¯«ç§’)ï¼Œé»˜è®¤ 100

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "status": "success",
    "speech_segments": [
        {
            "start": 0.5,
            "end": 2.3,
            "duration": 1.8
        },
        {
            "start": 3.1,
            "end": 4.8,
            "duration": 1.7
        }
    ],
    "statistics": {
        "total_segments": 2,
        "total_speech_duration": 3.5,
        "total_audio_duration": 5.0,
        "speech_ratio": 0.7,
        "sample_rate": 16000,
        "threshold_used": 0.5
    }
}
```

## æµ‹è¯•å·¥å…·

### åŸºç¡€æµ‹è¯•

```bash
python test_vad.py
```

### é«˜çº§æµ‹è¯•

```bash
python test_vad_advanced.py
```

é«˜çº§æµ‹è¯•åŒ…æ‹¬ï¼š
- æœåŠ¡çŠ¶æ€æ£€æŸ¥
- å¥åº·æ£€æŸ¥æµ‹è¯•
- æ¨¡å‹ä¿¡æ¯è·å–
- ä¸åŒé˜ˆå€¼æ•ˆæœå¯¹æ¯”
- è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯å±•ç¤º

## ä½¿ç”¨ç¤ºä¾‹

### Python å®¢æˆ·ç«¯ç¤ºä¾‹

```python
import requests

# æµ‹è¯•æœåŠ¡çŠ¶æ€
response = requests.get("http://127.0.0.1:8000/")
print(response.json())

# ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶è¿›è¡Œæ£€æµ‹
with open("audio.wav", "rb") as f:
    files = {"audio_file": f}
    params = {"threshold": 0.5}
    response = requests.post("http://127.0.0.1:8000/detect", 
                           files=files, params=params)
    result = response.json()
    
    for segment in result["speech_segments"]:
        print(f"è¯­éŸ³ç‰‡æ®µ: {segment['start']:.2f}s - {segment['end']:.2f}s")
```

### cURL ç¤ºä¾‹

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://127.0.0.1:8000/

# ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
curl -X POST "http://127.0.0.1:8000/detect?threshold=0.5" \
     -F "audio_file=@audio.wav"
```

## å‚æ•°è°ƒä¼˜æŒ‡å—

### æ£€æµ‹é˜ˆå€¼ (threshold)

- **0.3-0.4**ï¼šæ•æ„Ÿæ£€æµ‹ï¼Œå¯èƒ½åŒ…å«è¾ƒå¤šå™ªéŸ³
- **0.5**ï¼šé»˜è®¤å€¼ï¼Œå¹³è¡¡å‡†ç¡®æ€§å’Œæ•æ„Ÿæ€§
- **0.6-0.8**ï¼šä¿å®ˆæ£€æµ‹ï¼Œåªæ£€æµ‹æ˜æ˜¾çš„è¯­éŸ³

### æ—¶é•¿å‚æ•°

- **min_speech_duration_ms**ï¼šè¿‡æ»¤æ‰è¿‡çŸ­çš„è¯­éŸ³ç‰‡æ®µ
- **min_silence_duration_ms**ï¼šåˆå¹¶è¿‡è¿‘çš„è¯­éŸ³ç‰‡æ®µ

## æ€§èƒ½ä¼˜åŒ–

- é¦–æ¬¡ä½¿ç”¨æ—¶ä¼šä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼ˆ~40MBï¼‰
- æ¨¡å‹é‡‡ç”¨å»¶è¿ŸåŠ è½½ï¼Œåªåœ¨é¦–æ¬¡æ£€æµ‹æ—¶åŠ è½½
- æ”¯æŒéŸ³é¢‘æ–‡ä»¶ä¸´æ—¶å­˜å‚¨ï¼Œè‡ªåŠ¨æ¸…ç†
- å†…å­˜å ç”¨çº¦ 200-500MBï¼ˆå–å†³äºéŸ³é¢‘é•¿åº¦ï¼‰

## æ•…éšœæ’é™¤

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8000

# åœæ­¢ç°æœ‰æœåŠ¡
pkill -f vad_server.py
```

### 2. æ¨¡å‹ä¸‹è½½å¤±è´¥

```bash
# æ¸…ç† torch hub ç¼“å­˜
rm -rf ~/.cache/torch/hub/snakers4_silero-vad_master

# é‡æ–°å¯åŠ¨æœåŠ¡
python vad_server.py
```

### 3. éŸ³é¢‘æ ¼å¼ä¸æ”¯æŒ

- ç¡®ä¿éŸ³é¢‘æ–‡ä»¶æ˜¯ WAVã€MP3 æˆ– FLAC æ ¼å¼
- æ¨èä½¿ç”¨ 16kHz é‡‡æ ·ç‡çš„ WAV æ–‡ä»¶

## é›†æˆåˆ° Go é¡¹ç›®

VAD æœåŠ¡è®¾è®¡ä¸ºç‹¬ç«‹è¿è¡Œï¼ŒGo é¡¹ç›®å¯é€šè¿‡ HTTP å®¢æˆ·ç«¯è°ƒç”¨ï¼š

```go
// ç¤ºä¾‹ï¼šGo å®¢æˆ·ç«¯è°ƒç”¨ VAD æœåŠ¡
resp, err := http.Post("http://127.0.0.1:8000/detect", 
                      "multipart/form-data", audioData)
```

è¯¦ç»†çš„ Go é›†æˆä»£ç è¯·å‚è€ƒä¸»é¡¹ç›®çš„ VAD å®¢æˆ·ç«¯æ¨¡å—ã€‚

## å¼€å‘è¯´æ˜

- åŸºäº FastAPI æ¡†æ¶
- ä½¿ç”¨ Silero VAD é¢„è®­ç»ƒæ¨¡å‹
- æ”¯æŒ OpenAPI è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ
- åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½• 